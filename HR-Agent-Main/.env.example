# =============================================================================
# Compaytence Backend Environment Configuration
# =============================================================================
# CRITICAL: All environment-specific settings MUST be in this file
# Zero code changes required when promoting Dev → UAT → Prod
# Copy this file to .env and fill in actual values
# =============================================================================

# -----------------------------------------------------------------------------
# APPLICATION SETTINGS
# -----------------------------------------------------------------------------
ENVIRONMENT=development  # development | uat | production
APP_NAME=Compaytence AI Agent
APP_VERSION=0.1.0
DEBUG=true  # false in production
LOG_LEVEL=INFO  # DEBUG | INFO | WARNING | ERROR | CRITICAL

# API Configuration
API_V1_PREFIX=/api/v1
API_HOST=0.0.0.0
API_PORT=8000

# CORS Settings (comma-separated origins)
CORS_ORIGINS=http://localhost:3000,http://localhost:3001
CORS_CREDENTIALS=true
CORS_METHODS=GET,POST,PUT,DELETE,PATCH
CORS_HEADERS=*

# -----------------------------------------------------------------------------
# SECURITY & AUTHENTICATION
# -----------------------------------------------------------------------------
# Secret key for JWT signing (generate with: openssl rand -hex 32)
SECRET_KEY=your-secret-key-here-change-in-production

# JWT Configuration
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# Better Auth Configuration
BETTER_AUTH_URL=https://your-auth-domain.com
BETTER_AUTH_SECRET=your-better-auth-secret

# API Keys for External Services (if needed for service-to-service auth)
API_KEY_HEADER_NAME=X-API-Key
INTERNAL_API_KEY=your-internal-api-key

# -----------------------------------------------------------------------------
# DATABASE - SUPABASE
# -----------------------------------------------------------------------------
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key

# Database Connection (if direct PostgreSQL access needed)
DATABASE_URL=postgresql://user:password@host:5432/database

# Vector Search Configuration
VECTOR_SIMILARITY_THRESHOLD=0.75
VECTOR_MAX_RESULTS=5
HYBRID_SEARCH_ENABLED=true

# -----------------------------------------------------------------------------
# AI & LANGUAGE MODELS
# -----------------------------------------------------------------------------
# OpenAI Configuration
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_MODEL=gpt-4  # gpt-4 | gpt-4-turbo-preview | gpt-3.5-turbo
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
OPENAI_MAX_TOKENS=2000
OPENAI_TEMPERATURE=0.2  # Lower for finance accuracy

# Cohere Configuration (for reranking)
COHERE_API_KEY=your-cohere-api-key
COHERE_RERANK_MODEL=rerank-english-v3.0
COHERE_ENABLED=true

# Agent Configuration
AGENT_CONFIDENCE_THRESHOLD=0.95  # 95% threshold from spec
AGENT_MAX_ITERATIONS=5
AGENT_TIMEOUT_SECONDS=30
AGENT_ENABLE_STREAMING=true

# Conversation Memory (enables multi-turn conversations)
CONVERSATION_HISTORY_ENABLED=true
CONVERSATION_HISTORY_MAX_MESSAGES=20  # Max messages to include in context
CONVERSATION_HISTORY_MAX_TOKENS=4000  # Approximate token limit for history

# Semantic Caching (for cost optimization)
ENABLE_SEMANTIC_CACHE=true
CACHE_SIMILARITY_THRESHOLD=0.98
CACHE_TTL_SECONDS=3600

# -----------------------------------------------------------------------------
# OBSERVABILITY - LANGFUSE
# -----------------------------------------------------------------------------
LANGFUSE_PUBLIC_KEY=pk-lf-your-public-key
LANGFUSE_SECRET_KEY=sk-lf-your-secret-key
LANGFUSE_HOST=https://cloud.langfuse.com  # or self-hosted URL
LANGFUSE_ENABLED=true

# Tracing Configuration
LANGFUSE_SAMPLE_RATE=1.0  # 1.0 = trace everything, 0.1 = trace 10%
LANGFUSE_FLUSH_INTERVAL=10  # seconds

# -----------------------------------------------------------------------------
# BACKGROUND JOBS - INNGEST
# -----------------------------------------------------------------------------
INNGEST_EVENT_KEY=your-inngest-event-key
INNGEST_SIGNING_KEY=your-inngest-signing-key
INNGEST_ENV=development  # development | production

# Workflow Configuration
INNGEST_SERVE_PATH=/api/inngest
INNGEST_MAX_RETRIES=3
INNGEST_RETRY_DELAY_SECONDS=60

# -----------------------------------------------------------------------------
# DOCUMENT PROCESSING - DOCLING
# -----------------------------------------------------------------------------
DOCLING_ENABLED=true
DOCLING_MAX_FILE_SIZE_MB=50
DOCLING_SUPPORTED_FORMATS=pdf,docx,xlsx,pptx,txt,md
DOCLING_OCR_ENABLED=true
DOCLING_PRESERVE_TABLES=true

# Chunking Configuration
CHUNK_SIZE=1000
CHUNK_OVERLAP=200
ENABLE_STRUCTURE_AWARE_CHUNKING=true

# -----------------------------------------------------------------------------
# CHAT PLATFORM INTEGRATIONS
# -----------------------------------------------------------------------------
# Slack
SLACK_BOT_TOKEN=xoxb-your-slack-bot-token
SLACK_SIGNING_SECRET=your-slack-signing-secret
SLACK_APP_TOKEN=xapp-your-slack-app-token
SLACK_WEBHOOK_URL=/api/v1/webhooks/slack

# WhatsApp Business API
WHATSAPP_BUSINESS_ACCOUNT_ID=your-whatsapp-business-id
WHATSAPP_ACCESS_TOKEN=your-whatsapp-access-token
WHATSAPP_PHONE_NUMBER_ID=your-phone-number-id
WHATSAPP_WEBHOOK_VERIFY_TOKEN=your-webhook-verify-token
WHATSAPP_WEBHOOK_URL=/api/v1/webhooks/whatsapp

# Telegram
TELEGRAM_BOT_TOKEN=your-telegram-bot-token
TELEGRAM_API_ID=your-telegram-api-id
TELEGRAM_API_HASH=your-telegram-api-hash
TELEGRAM_WEBHOOK_URL=/api/v1/webhooks/telegram

# Historical Data Ingestion (Telethon)
TELEGRAM_SESSION_STRING=your-telegram-session-string
TELEGRAM_PHONE_NUMBER=your-phone-number

# Telegram Error Notifications (for backend error alerts)
TELEGRAM_ERROR_BOT_TOKEN=7851252299:AAFhfCl2eNoFsktjaTYviue7Lec9pmoLVRo
TELEGRAM_ERROR_CHAT_ID=-1002386016697
TELEGRAM_ERROR_THREAD_ID=8393
TELEGRAM_ERROR_NOTIFICATIONS_ENABLED=true

# -----------------------------------------------------------------------------
# FILE STORAGE & UPLOADS
# -----------------------------------------------------------------------------
# Upload Configuration
MAX_UPLOAD_SIZE_MB=50
ALLOWED_UPLOAD_EXTENSIONS=pdf,docx,xlsx,pptx,txt,md,csv
UPLOAD_TEMP_DIR=/tmp/uploads

# Storage Backend (if using cloud storage)
STORAGE_BACKEND=supabase  # supabase | s3 | local
STORAGE_BUCKET=compaytence-documents

# S3 Configuration (if using S3)
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_REGION=us-east-1
S3_BUCKET=compaytence-documents

# -----------------------------------------------------------------------------
# RATE LIMITING & THROTTLING
# -----------------------------------------------------------------------------
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_PER_HOUR=1000

# Cost Control (for OpenAI API)
MAX_TOKENS_PER_USER_PER_DAY=100000
COST_ALERT_THRESHOLD_USD=1000

# -----------------------------------------------------------------------------
# MONITORING & ALERTS
# -----------------------------------------------------------------------------
# Sentry (Error Tracking)
SENTRY_DSN=your-sentry-dsn
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_ENVIRONMENT=development

# Health Check Configuration
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_INTERVAL_SECONDS=30

# -----------------------------------------------------------------------------
# DEPLOYMENT - RAILWAY
# -----------------------------------------------------------------------------
# Railway auto-injects these, but documenting for reference
# RAILWAY_ENVIRONMENT=production
# RAILWAY_DEPLOYMENT_ID=auto-generated
# RAILWAY_SERVICE_NAME=compaytence-backend

# -----------------------------------------------------------------------------
# PII & SECURITY
# -----------------------------------------------------------------------------
# PII Anonymization (Presidio)
PII_ANONYMIZATION_ENABLED=true
PII_REDACTION_PLACEHOLDER=[REDACTED]
PII_MIN_CONFIDENCE_SCORE=0.6
PII_DEFAULT_STRATEGY=replace  # redact | replace | mask | hash | keep

# -----------------------------------------------------------------------------
# DATA RETENTION & GDPR
# -----------------------------------------------------------------------------
# Retention Policies
RETENTION_ENABLED=true
RETENTION_CHAT_MESSAGES_DAYS=365  # 1 year
RETENTION_ADMIN_UPLOADS_DAYS=730  # 2 years
RETENTION_AUDIT_LOGS_DAYS=2555  # 7 years (compliance requirement)
RETENTION_AUTO_DELETE_ENABLED=false  # Require manual approval for auto-deletion

# -----------------------------------------------------------------------------
# FEATURE FLAGS
# -----------------------------------------------------------------------------
FEATURE_ADMIN_PORTAL=true
FEATURE_EMBEDDABLE_WIDGET=true
FEATURE_TELEGRAM_INTEGRATION=true
FEATURE_SLACK_INTEGRATION=true
FEATURE_WHATSAPP_INTEGRATION=true
FEATURE_HISTORICAL_INGESTION=true
FEATURE_DOCUMENT_UPLOAD=true

# -----------------------------------------------------------------------------
# TESTING & DEVELOPMENT
# -----------------------------------------------------------------------------
# Test Mode (disable external API calls)
TEST_MODE=false
MOCK_EXTERNAL_APIS=false

# Development Tools
ENABLE_API_DOCS=true  # /docs endpoint
ENABLE_RELOAD=true  # Hot reload
ENABLE_PROFILING=false

# -----------------------------------------------------------------------------
# NOTES FOR ENVIRONMENT-SPECIFIC CONFIGURATION
# -----------------------------------------------------------------------------
# DEV:
#   - DEBUG=true, LOG_LEVEL=DEBUG
#   - CORS_ORIGINS includes localhost
#   - LANGFUSE_SAMPLE_RATE=1.0 (trace everything)
#   - RATE_LIMIT_ENABLED=false
#   - ENABLE_API_DOCS=true
#
# UAT:
#   - DEBUG=false, LOG_LEVEL=INFO
#   - CORS_ORIGINS includes UAT frontend URL
#   - LANGFUSE_SAMPLE_RATE=0.5 (trace 50%)
#   - RATE_LIMIT_ENABLED=true
#   - ENABLE_API_DOCS=true
#
# PROD:
#   - DEBUG=false, LOG_LEVEL=WARNING
#   - CORS_ORIGINS includes production frontend URL only
#   - LANGFUSE_SAMPLE_RATE=0.1 (trace 10%)
#   - RATE_LIMIT_ENABLED=true
#   - ENABLE_API_DOCS=false (security)
#   - All secrets rotated from UAT
# =============================================================================
